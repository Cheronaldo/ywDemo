<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script src="../static/assets/js/jquery-2.0.3.min.js" th:src="@{/assets/js/jquery-2.0.3.min.js}"></script>
    <!-- <script src="../static/assets/js/jQuery.md5.js" th:src="@{/assets/js/jQuery.md5.js}"></script> -->
	<title>亿维智能云平台设备列表页面</title>
	<style type="text/css">
		.dev{
			border: 1px solid;
			border-bottom: 0; 
			border-color: black;
		}
		.dev:last-child{
			border-bottom: 1px solid;
		}
		.siteName {
			color: blue;
		}
		.siteImg{
			width: 90px;
			height: 60px;
			margin:0 10px;
			display: inline-block;
		}
		.siteImg > img {
			height: 100%;
		}
		span{
		}
		.siteInfo {
			display: inline-block;
			margin-bottom: 5px;
		}
		.dev-a{
			text-decoration: none;
			margin-left: 20px;
		}
	</style>
	<script type="text/javascript">
        var getUrl = window.parent.location.search;
        var userName = getUrl.substring(10);
		$(function() {
			askList();
		});
		function askList(){
			$.ajax({
	                url: "/device/site/deviceList",
	                cache: false,
	                dataType:'json',
	                data : {
	                    "userName":userName,
	                },
	                type : 'post',
	                beforeSend: function () {
	                    
	                },
	                success: function(result){
	                    if (result.code == 0) {
	                    	alert(result.msg);
	                    	append(result.data);
	                    }
	                    else{
	                    	alert(result.msg);
	                    }
	                },
	                complete: function () {
	                    
	                },
	                error: function (data) {
	                    console.info("error: " + data.responseText);
	                }
	            });
		}

		function append(data){
			for (var item in data) {
//				var strDevicetr = $("<div class='dev'><tr><td>SN码：" + data[item].snCode +
//											"</td></br><td>设备地址：" + data[item].deviceAddress +
//											"</td></br><td>在线状态：" + translate(data[item].isOnline) +
//											"</td></br><td>站点信息：" + data[item].siteName +
//											"</td></br><td>设备型号：" + data[item].deviceModel + "</td></tr></div>");
                var strDevicetr = $("<div class='dev'><div class = 'siteImg'><img alt='现场图片暂无' src='" + data[item].siteIcon +
											"' /></div><div class = 'siteInfo'><tr><span class='siteName'>" + data[item].siteName +
											"</span></br><span>在线状态：</span>" + translate(data[item].isOnline) +
											"<a href='/deviceConfig?devSNCode=" + data[item].snCode +
											"' target='fname' style='color: #ffa700' class='devConfig dev-a'>配置</a>" +
											"<a href='#' target='fname' style='color: #00abff' class='devInfo dev-a'>设备数据</a>" +
                    						"</span></br><span>设备地址：" + data[item].deviceAddress +
											"</span></tr></div></div>");
				$("#devList").append(strDevicetr);
			}
		}
		function translate(code){
			if (code == 1) {return "<span style='color: #35c813'>在线";}
				else if (code == 0) {return "<span style='color: #a300a3'>离线";}
				else{
					return "<span style='color: red'>error";
				}
		}
	</script>
</head>
<body>
	<div class="devList" id="devList"></div>
</body>
</html>